<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hist√≥rico Gastos</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='bolsa.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>

    <!-- Barra lateral -->
    <div class="sidebar">
        <h3>Men√∫</h3>
        <a href="/">Inicio</a>
        <a href="/report">Estad√≠sticas</a>
        <a href="/config">Configuraci√≥n</a>

        <!-- Mostrar mensajes flash -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Selector de fecha en la barra lateral -->
        <div class="date-selector">
            <form action="/gastos" method="POST">
                <label for="mes">Mes:</label>
                <select name="mes" id="mes">
                    <option value="">Todos</option>
                    {% for mes in ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", 
                                "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"] %}
                        <option value="{{ mes }}" {% if filtros.mes == mes %}selected{% endif %}>{{ mes }}</option>
                    {% endfor %}
                </select>

                <label for="anio">A√±o:</label>
                <select name="anio" id="anio">
                    <option value="">Todos</option>
                    {% for anio in range(2025, 2051) %}
                        <option value="{{ anio }}" {% if filtros.anio == anio %}selected{% endif %}>{{ anio }}</option>
                    {% endfor %}
                </select>

                <br>

                <label for="categoria">Categor√≠a:</label>
                <select name="categoria" id="categoria">
                    <option value="">Todas</option>
                    {% for categoria in categorias %}
                        <option value="{{ categoria }}" {% if filtros.categoria == categoria %}selected{% endif %}>{{ categoria }}</option>
                    {% endfor %}
                </select>

                <button type="submit">Filtrar</button>
            </form>
        </div>
    </div>

    <!-- Contenedor principal con margen para la barra lateral -->
    <div class="content">

        <!-- Encabezado principal -->
        <header class="main-header">
            <h1>Seguimiento cuentas Pino</h1>
        </header>    

        <h1>Hist√≥rico de Gastos</h1>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Categor√≠a</th>
                        <th>Descripci√≥n</th>
                        <th>Monto (‚Ç¨)</th>
                        <th>Mes</th>
                        <th>A√±o</th>
                    </tr>
                </thead>
                <tbody>
                    {% for gasto in gastos %}
                    <tr>
                        <td>{{ gasto.categoria }}</td>
                        <td>{{ gasto.descripcion }}</td>
                        <td>{{ gasto.monto }}</td>
                        <td>{{ gasto.mes }}</td>
                        <td>{{ gasto.anio }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Informaci√≥n de paginaci√≥n -->
        <div class="pagination-info">
            <p>Mostrando {{ gastos|length }} de {{ total_gastos }} gastos | P√°gina {{ page }} de {{ total_pages }}</p>
        </div>

        <!-- Controles de paginaci√≥n -->
        <div class="pagination">
            {% if page > 1 %}
                <a href="{{ url_for('main.ver_gastos', page=page-1, mes=filtros.get('mes', ''), anio=filtros.get('anio', ''), categoria=filtros.get('categoria', '')) }}" class="pagination-btn">‚Üê Anterior</a>
            {% else %}
                <span class="pagination-btn disabled">‚Üê Anterior</span>
            {% endif %}

            {% for p in range(1, total_pages + 1) %}
                {% if p == page %}
                    <span class="pagination-btn active">{{ p }}</span>
                {% elif p == 1 or p == total_pages or (p >= page - 2 and p <= page + 2) %}
                    <a href="{{ url_for('main.ver_gastos', page=p, mes=filtros.get('mes', ''), anio=filtros.get('anio', ''), categoria=filtros.get('categoria', '')) }}" class="pagination-btn">{{ p }}</a>
                {% elif p == page - 3 or p == page + 3 %}
                    <span class="pagination-btn disabled">...</span>
                {% endif %}
            {% endfor %}

            {% if page < total_pages %}
                <a href="{{ url_for('main.ver_gastos', page=page+1, mes=filtros.get('mes', ''), anio=filtros.get('anio', ''), categoria=filtros.get('categoria', '')) }}" class="pagination-btn">Siguiente ‚Üí</a>
            {% else %}
                <span class="pagination-btn disabled">Siguiente ‚Üí</span>
            {% endif %}
        </div>

        <!-- Bot√≥n de descarga -->
        <div class="download-section">
            <a href="{{ url_for('main.descargar_gastos', mes=filtros.get('mes', ''), anio=filtros.get('anio', ''), categoria=filtros.get('categoria', '')) }}" class="btn-download">
                üì• Descargar CSV
            </a>
        </div>

    </div>

</body>
</html>
